# DART 연결재무제표 주석 자동화 크롤러

한국 DART(Data Analysis, Retrieval and Transfer) 시스템에서 상장기업의 연결재무제표 주석을 자동으로 수집하고, 표 데이터를 구조화된 CSV 파일로 변환하는 Python 자동화 도구입니다.

## 🚀 주요 기능

### 📊 **DART 크롤링**
- 회사명으로 DART 고유번호 자동 검색
- 다양한 보고서 유형 지원 (사업보고서, 반기보고서, 1분기/3분기보고서)
- 연결재무제표 주석 HTML 파일 자동 다운로드
- 1분기/3분기보고서 구분 처리 (접수일 기반)

### 📋 **표 데이터 자동 추출**
- "1. 지배기업의 개요" 섹션 (1)~(7) 표 자동 추출
- 2024년("회사의 개요")과 2025년("지배기업의 개요") 형식 모두 지원
- 표 제목, 기간구분, 단위 정보 자동 인식
- 중복 헤더 제거 및 데이터 정규화
- CSV 파일로 구조화된 데이터 출력

### ⚡ **일괄 처리**
- JSON 설정 파일 기반 여러 기업 동시 처리
- 크롤링부터 CSV 생성까지 완전 자동화
- 에러 처리 및 진행상황 실시간 표시

## 📁 지원하는 보고서 유형

| 번호 | 보고서명 | DART 코드 | 특이사항 |
|------|----------|-----------|----------|
| 1 | 사업보고서 | 11011 | 연간 보고서 |
| 2 | 반기보고서 | 11014 | 6개월 보고서 |
| 3 | 분기보고서 | 11013 | 일반 분기 |
| 4 | 1분기보고서 | 11013 | 2~5월 접수 |
| 5 | 3분기보고서 | 11013 | 8~11월 접수 |

## 🛠️ 설치 및 설정

### 1. 저장소 클론
```bash
git clone https://github.com/june4432/dart_crawler.git
cd dart_crawler
```

### 2. 패키지 설치
```bash
pip install -r requirements.txt
```

### 3. 환경변수 설정
`.env` 파일을 생성하고 다음 내용을 입력:
```env
DART_API_KEY=your_dart_api_key_here
DART_CORP_CODE_URL=https://opendart.fss.or.kr/api/corpCode.xml
DART_LIST_URL=https://opendart.fss.or.kr/api/list.json
OUTPUT_DIR=result
```

## 🔑 DART API 키 발급

1. [DART 전자공시시스템](https://opendart.fss.or.kr/) 접속
2. 상단 메뉴 "오픈API" → "개발가이드" → "신청·인증키 발급"
3. 회원가입 후 인증키 발급신청
4. 발급받은 API 키를 `.env` 파일에 설정

## 📖 사용법

### 🎯 **일괄 처리 모드 (권장)**

#### 1. 기업 설정 파일 작성
`companies_config.json` 파일을 생성:
```json
{
  "companies": [
    {
      "company_name": "한솔피엔에스",
      "year": "2025",
      "report_type": "반기보고서",
      "description": "한솔피엔에스 2025년 반기보고서"
    },
    {
      "company_name": "삼성전자",
      "year": "2024",
      "report_type": "사업보고서",
      "description": "삼성전자 2024년 사업보고서"
    }
  ],
  "extraction_config": {
    "target_sections": ["1. 지배기업의 개요"],
    "subsections": ["(1)", "(2)", "(3)", "(4)", "(5)", "(6)", "(7)"],
    "output_format": "csv",
    "encoding": "utf-8-sig"
  }
}
```

#### 2. 실행
```bash
python dart_crawler.py
```

#### 3. 모드 선택
```
📄 JSON 설정 파일이 발견되었습니다.
🔧 실행 모드를 선택하세요 (1: 일괄처리, 2: 대화형): 1
```

### 🎭 **대화형 모드**

JSON 설정 파일이 없거나 개별 처리가 필요한 경우:
```bash
python dart_crawler.py
```

1. 회사명 입력 (예: "한솔피엔에스")
2. 보고서 유형 선택 (1-5)
3. 연도 입력 (예: "2025")
4. 파일 저장 확인

## 📂 출력 파일

### 📊 **HTML 파일**
```
result/{회사명}_{연도}_{보고서유형}_연결재무제표주석.html
```
- 메타데이터가 포함된 보기 좋은 HTML 형식
- 회사 정보, 접수번호, URL 등 포함

### 📈 **CSV 파일**
```
result/{회사명}_{연도}_{보고서유형}_표데이터.csv
```

#### CSV 구조:
| 컬럼 | 설명 | 예시 |
|------|------|------|
| 회사명 | 기업명 | 한솔피엔에스 |
| 년도 | 보고서 연도 | 2025 |
| 보고서구분 | 보고서 유형 | 반기보고서 |
| 항목번호 | 섹션 번호 | 1, 3, 4 |
| 항목제목 | 섹션 제목 | 종속기업의 현황 |
| 기간구분 | 기간 정보 | 당반기말, 전기말 |
| 단위 | 수치 단위 | 천원, 백만원 |
| ... | 표 데이터 | 실제 재무 데이터 |

## 🔧 주요 개선사항 (2024.12.24)

### ✅ **섹션 패턴 지원 확대**
- 2024년 형식: `"1. 회사의 개요"`
- 2025년 형식: `"1. 지배기업의 개요"`
- 두 형식 모두 자동 인식

### ⚡ **완전 자동화**
- 사용자 입력 없이 크롤링 → 표 추출 → CSV 생성
- 중간 확인 단계 제거로 UX 개선

### 🎯 **1분기/3분기보고서 구분**
- 접수일 기반 자동 구분 (2-5월: 1분기, 8-11월: 3분기)
- DART API 특성을 반영한 정확한 보고서 매칭

### 📊 **데이터 품질 향상**
- 중복 헤더 자동 제거
- 단위 정보 별도 컬럼 추출
- 한글 인코딩 문제 해결 (UTF-8-BOM)

## 📋 프로젝트 구조

```
dart_crawler/
├── dart_crawler.py          # 메인 크롤러 (DART API 연동)
├── table_extractor.py       # 표 데이터 추출 엔진
├── companies_config.json    # 기업 설정 파일
├── requirements.txt         # 종속성 패키지
├── .env                     # 환경변수 (API 키)
├── README.md               # 이 파일
└── result/                 # 출력 파일 디렉토리
    ├── {회사명}_{년도}_{보고서}_연결재무제표주석.html
    └── {회사명}_{년도}_{보고서}_표데이터.csv
```

## 🚦 사용 예시

### 전체 프로세스 실행:
```bash
$ python dart_crawler.py
📄 JSON 설정 파일이 발견되었습니다.
🔧 실행 모드를 선택하세요 (1: 일괄처리, 2: 대화형): 1

✅ 설정 파일 로드 완료: 2개 기업
🚀 DART 연결재무제표 주석 일괄 크롤링 시작

📋 [1/2] 한솔피엔에스 2025 반기보고서 처리 중...
✅ 한솔피엔에스 처리 완료

📋 [2/2] 삼성전자 2024 사업보고서 처리 중...
✅ 삼성전자 처리 완료

🎉 모든 기업의 크롤링이 완료되었습니다!

🔄 표 데이터 추출을 자동으로 시작합니다...
✅ 표 데이터 추출이 완료되었습니다!
```

## 🔍 트러블슈팅

### API 관련
- **API 키 에러**: `.env` 파일의 `DART_API_KEY` 확인
- **요청 제한**: DART API는 분당 요청 제한이 있습니다

### 데이터 추출 관련
- **섹션 없음**: 해당 보고서에 "지배기업의 개요" 섹션이 없을 수 있습니다
- **인코딩 문제**: CSV 파일은 UTF-8-BOM으로 저장되어 Excel에서 바로 열 수 있습니다

### 파일 관련
- **권한 에러**: 출력 파일이 다른 프로그램에서 열려있는지 확인
- **경로 에러**: `result/` 디렉토리가 자동 생성됩니다

## 📞 지원

문제가 발생하거나 개선사항이 있다면 GitHub Issues를 통해 알려주세요.

## 📜 라이선스

MIT License

---

> **⚠️ 주의사항**: 이 도구는 공개된 DART 정보를 활용하며, 수집된 데이터의 사용은 관련 법규를 준수해야 합니다.